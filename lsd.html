<meta charset="utf-8">

<style>
  * { background: black; color: white; font-family: sans-serif; }
  body { width: 100%; height: 100%; }

  #strip { position: relative; width: 100%; height: 16px; background: white; }
  #strip * { 
	  position: absolute; 
	  width: 16px; height: 16px; top: -3px; margin-left: -8px; 
	  border: 3px solid lightgrey; border-radius: 50%; 
	  background: none; color: transparent; cursor: default;
	}

//  #colorEditor { position: absolute; width: 200px; display: none; }
  #colorEditor { position: absolute; width: 200px; }
 </style>


<h1>LED Strip Designer</h1>
<div id="strip">
    <div style="left: 10%" onmousedown="startDrag(event)" >#0000ff</div>
    <div style="left: 25%" onmousedown="startDrag(event)" >#00ff00</div>
    <div style="left: 50%" onmousedown="startDrag(event)" >#ffff00</div>
    <div style="left: 75%" onmousedown="startDrag(event)" >#ff0000</div>
    <div style="left: 90%" onmousedown="startDrag(event)" >#ff0000</div>
</div>
<canvas id="colorEditor"></canvas>


<script src="lib/html5kellycolorpicker.min.js"></script>

<script>
draw = ()=>{
	var s = 'linear-gradient(to right, ';
	for(var i of [].slice.call(document.querySelectorAll("#strip *")).sort((i,j)=>i.offsetLeft-j.offsetLeft)){
		var m = Number(getComputedStyle(i).marginLeft.replace('px', ''));
		var x = (i.offsetLeft-m) /i.parentElement.offsetWidth *100;
		s += i.innerHTML+' '+x+'%, ';
	}
	s = s.substring(0,s.length-2)+')';
	document.querySelector('#strip').style.background = s;
}
draw();


var drag;
startDrag = (event)=>{
	drag = event.target;
	drag.dx = event.clientX - drag.offsetLeft;
	editColor();
	event.preventDefault();
}
window.addEventListener('mouseup', (event)=>{
	drag = null;
})
document.body.addEventListener('mousemove', (event)=>{
	if(drag){
		var m = Number(getComputedStyle(drag).marginLeft.replace('px', ''));
		drag.style.left = (event.clientX - drag.dx-m) +'px';
		draw();
		
		var x = drag.offsetLeft + drag.offsetWidth/2 - document.querySelector('#colorEditor').offsetWidth /2;
		if(x<drag.parentElement.offsetLeft) x=drag.parentElement.offsetLeft;
		if(x>drag.parentElement.offsetLeft+drag.parentElement.offsetWidth-document.querySelector('#colorEditor').offsetWidth)
			x = drag.parentElement.offsetLeft+drag.parentElement.offsetWidth-document.querySelector('#colorEditor').offsetWidth;
		document.querySelector('#colorEditor').style.left = x+'px';
	}
})

var colorPicker;
editColor = ()=>{
/*
	var colorEditor = document.querySelector('#colorEditor');
	if(colorEditor.style.display=='block')
		colorEditor.style.display = 'none';
	else
		colorEditor.style.display = 'block';
*/
	var x = drag.offsetLeft + drag.offsetWidth/2 - document.querySelector('#colorEditor').offsetWidth /2;
	if(x<drag.parentElement.offsetLeft) x=drag.parentElement.offsetLeft;
	if(x>drag.parentElement.offsetLeft+drag.parentElement.offsetWidth-document.querySelector('#colorEditor').offsetWidth)
		x = drag.parentElement.offsetLeft+drag.parentElement.offsetWidth-document.querySelector('#colorEditor').offsetWidth;
	document.querySelector('#colorEditor').style.left = x+'px';

	var i = drag;
	colorPicker = new KellyColorPicker({
		place: colorEditor,
		size: 200,
		color: i.innerHTML,
		methodSwitch : true,
		changeCursor: false,
		userEvents: { 
			change : (self)=>{
				i.innerHTML = self.getCurColorHex();
				draw();
			}
		}
	});
}
</script>
